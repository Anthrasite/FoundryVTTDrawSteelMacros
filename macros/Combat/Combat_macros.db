{ "_id": "VuzLJPa7S52xeU9X", "name": "End combat", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/skills/melee/blade-tip-chipped-blood-red.webp", "command": "//@id=VuzLJPa7S52xeU9X\n//@name=End combat\n//@img=icons/skills/melee/blade-tip-chipped-blood-red.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const gainedVictories = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Victories`, label: `Victories earned`, defaultValue: 1, allowNegative: false }));\n  if (gainedVictories > 0)\n    await game.macros.getName(\"UpdateAttribute\").execute({ attributeName: \"victories\", value: gainedVictories, isDelta: true });\n\n  await game.macros.getName(\"UpdateAttribute\").execute({ attributeName: \"surges\", value: 0 });\n  await game.macros.getName(\"UpdateAttribute\").execute({ attributeName: \"resource\", value: 0 });\n  await game.macros.getName(\"UpdatePersistentCost\").execute();\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "4ldruWznMIR26JA5", "name": "End persistent effect", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/magic/light/hand-sparks-smoke-teal.webp", "command": "//@id=4ldruWznMIR26JA5\n//@name=End persistent effect\n//@img=icons/magic/light/hand-sparks-smoke-teal.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const resourceLabel = (await game.macros.getName(`GetAttribute`).execute({ attributeName: `resource` })).label;\n  const selectedAbilities = await game.macros.getName(\"ShowPersistentCostDialog\").execute({ label: `Persistent effects to end`, resourceLabel });\n  if (!selectedAbilities)\n    ui.notifications.info(`No active persistent effects!`);\n  else\n    for (const abilityName of selectedAbilities)\n      await game.macros.getName(`UpdatePersistentCost`).execute({ abilityName });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "C9Rq36QntKBJ78Uf", "name": "Gain resource", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/magic/symbols/ring-circle-smoke-blue.webp", "command": "//@id=C9Rq36QntKBJ78Uf\n//@name=Gain resource\n//@img=icons/magic/symbols/ring-circle-smoke-blue.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const resource = await game.macros.getName(`GetAttribute`).execute({ attributeName: `resource` });\n  const resourceLabel = resource.label.capitalize();\n  const resourceGain = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: resourceLabel, label: `${resourceLabel} gained`, defaultValue: 1, allowNegative: false }));\n\n  if (resourceGain > 0) {\n    const roll = await new Roll(`${resource.value} + ${resourceGain}`).evaluate();\n    await game.macros.getName(`ShareRoll`).execute({\n      roll,\n      flavor: resourceLabel\n    });\n\n    await game.macros.getName(`UpdateAttribute`).execute({ attributeName: `resource`, value: resourceGain, isDelta: true });\n  }\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "2goha35ftCeBsPiS", "name": "Gain surges", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/magic/sonic/explosion-shock-wave-teal.webp", "command": "//@id=2goha35ftCeBsPiS\n//@name=Gain surges\n//@img=icons/magic/sonic/explosion-shock-wave-teal.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const surgesGained = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Surges`, label: `Surges gained`, defaultValue: 1, allowNegative: false }));\n\n  if (surgesGained > 0)\n    await game.macros.getName(`UpdateAttribute`).execute({ attributeName: `surges`, value: surgesGained, isDelta: true });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "jte0ZyibHwRUDQsM", "name": "Gain victories", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/commodities/treasure/cup-trophy-gold.webp", "command": "//@id=jte0ZyibHwRUDQsM\n//@name=Gain victories\n//@img=icons/commodities/treasure/cup-trophy-gold.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const victoriesGained = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Victories`, label: `Victories gained`, defaultValue: 1, allowNegative: false }));\n\n  if (victoriesGained > 0)\n    await game.macros.getName(`UpdateAttribute`).execute({ attributeName: `victories`, value: victoriesGained, isDelta: true });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "hi1QF7EwgHD3eLVn", "name": "Roll initiative", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/skills/movement/figure-running-gray.webp", "command": "//@id=hi1QF7EwgHD3eLVn\n//@name=Roll initiative\n//@img=icons/skills/movement/figure-running-gray.webp\nconst roll = await new Roll(`1d10`).evaluate();\nconst heroesActFirst = roll.total >= 6;\nawait game.macros.getName(`ShareRoll`).execute({\n  roll,\n  flavor: `<span style=\"color: ${heroesActFirst ? `#008000` : `#800000`};\">${heroesActFirst ? `Heroes` : `Foes`} strike first!</span>`\n});" }
{ "_id": "zawCdUf340GQMJDK", "name": "Start combat", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/skills/melee/hand-grip-sword-orange.webp", "command": "//@id=zawCdUf340GQMJDK\n//@name=Start combat\n//@img=icons/skills/melee/hand-grip-sword-orange.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const victories = (await game.macros.getName(`GetAttribute`).execute({ attributeName: `victories` })).value;\n\n  const resource = await game.macros.getName(`UpdateAttribute`).execute({ attributeName: `resource`, value: victories });\n\n  const roll = await new Roll(`${victories}[victories]`).evaluate();\n  await game.macros.getName(`ShareRoll`).execute({\n    roll,\n    flavor: `Initial ${resource.label}`\n  });\n}\ncatch (error) {\n  ui.notifications.error(error);\n}" }
{ "_id": "fHT9Y1QkwMhazr7D", "name": "Use recovery", "scope": "global", "type": "script", "permission": { "default": 0 }, "img": "icons/magic/life/cross-worn-green.webp", "command": "//@id=fHT9Y1QkwMhazr7D\n//@name=Use recovery\n//@img=icons/magic/life/cross-worn-green.webp\ntry {\n  await game.macros.getName(\"ValidateActorAttributes\").execute();\n\n  const health = (await game.macros.getName(`GetAttribute`).execute({ attributeName: `health` }));\n\n  if (health.value >= health.max)\n    ui.notifications.info(`Health is already full!`);\n  else {\n    const recoveries = (await game.macros.getName(`GetAttribute`).execute({ attributeName: `recoveries` }));\n\n    if (recoveries.value <= 0)\n      ui.notifications.info(`No recoveries left!`);\n    else {\n      const recoveryValue = Math.floor(health.max / 3);\n      const newHealth = Math.min(health.value + recoveryValue, health.max);\n\n      if (newHealth < health.value + recoveryValue) {\n        const useRecovery = await Dialog.confirm({\n          title: `Use recovery?`,\n          content: `<p>Warning: If you use a recovery, ${health.value + recoveryValue - newHealth} health will be wasted. Do you still want to use a recovery?</p>`,\n          defaultYes: false\n        });\n        if (!useRecovery)\n          return;\n      }\n\n      await game.macros.getName(`UpdateAttribute`).execute({ attributeName: `health`, value: newHealth });\n      await game.macros.getName(`UpdateAttribute`).execute({ attributeName: `recoveries`, value: -1, isDelta: true });\n    }\n  }\n}\ncatch (error) {\n  ui.notifications.error(error);\n}" }
